#!/bin/bash
# preparing for paw execution of commands 
# run if from MASTER node, as argument put client host name
set -x
CLIENT_NODE=$1
sed -i '/StrictHostKeyChecking/c\StrictHostKeyChecking no' /etc/ssh/ssh_config
ssh-keygen -t rsa -N "" -f ~/.ssh/id_rsa
MASTER_RSA_PUB_KEY=$(cat ~/.ssh/id_rsa.pub)
echo $MASTER_RSA_PUB_KEY
salt $CLIENT_NODE cmd.run "echo $MASTER_RSA_PUB_KEY >> ~/.ssh/authorized_keys"
ssh $CLIENT_NODE "cat ~/.ssh/authorized_keys"
